<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PassBox - æœ¬åœ°å¯†ç ç®¡ç†å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* iOS åŸºç¡€æ ·å¼ */
        :root {
            /* iOS ç³»ç»Ÿè‰²å½© */
            --ios-primary: #007AFF;
            --ios-secondary: #5856D6;
            --ios-success: #34C759;
            --ios-warning: #FF9500;
            --ios-danger: #FF3B30;
            --ios-gray: #8E8E93;
            --ios-gray-light: #C7C7CC;
            --ios-gray-dark: #48484A;
            --ios-background: #F2F2F7;
            --ios-card: #FFFFFF;
            --ios-text-primary: #000000;
            --ios-text-secondary: #8E8E93;
            --ios-text-tertiary: #C7C7CC;
            
            /* iOS åœ†è§’ */
            --ios-corner-small: 8px;
            --ios-corner-medium: 12px;
            --ios-corner-large: 16px;
            --ios-corner-xl: 28px;
            
            /* iOS é˜´å½± */
            --ios-shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --ios-shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --ios-shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        body {
            /* iOS ç³»ç»Ÿå­—ä½“ */
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Icons', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: var(--ios-background);
            color: var(--ios-text-primary);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow: hidden; /* ç¦æ­¢é¡µé¢æ»šåŠ¨ */
        }

        /* iOS å®¹å™¨æ ·å¼ */
        .container {
            width: 100%;
            margin: 0;
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
        }

        /* iOS å¯¼èˆªæ æ ·å¼ */
        header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: var(--ios-text-primary);
            padding: 16px 20px;
            text-align: center;
            border-bottom: 1px solid var(--ios-gray-light);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        h1 {
            font-size: 17px;
            font-weight: 600;
            letter-spacing: -0.3px;
        }

        /* è‡ªå®šä¹‰iOSé£æ ¼æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--ios-gray-light);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--ios-gray);
        }

        .content {
            padding: 8px;
            overflow: hidden;
            height: calc(100vh - 150px);
            display: flex;
        }

        /* iOS è®¤è¯ç•Œé¢æ ·å¼ */
        .auth-container {
            max-width: 375px;
            margin: 60px auto;
            padding: 24px;
            background: var(--ios-card);
            border-radius: var(--ios-corner-xl);
            box-shadow: var(--ios-shadow-md);
            overflow: hidden;
        }

        .auth-title {
            text-align: center;
            margin-bottom: 8px;
            color: var(--ios-text-primary);
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .auth-subtitle {
            text-align: center;
            margin-bottom: 32px;
            color: var(--ios-text-secondary);
            font-size: 17px;
            font-weight: 400;
            letter-spacing: -0.3px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--ios-text-primary);
            font-size: 13px;
            letter-spacing: -0.1px;
        }

        /* æ·»åŠ æ–°å¯†ç ç•Œé¢çš„å°é—´è· */
        #addPasswordScreen .form-group {
            margin-bottom: 12px;
        }

        #addPasswordScreen label {
            margin-bottom: 6px;
            font-size: 12px;
        }

        /* iOS æ–‡æœ¬æ¡†æ ·å¼ */
        input {
            width: 100%;
            padding: 16px;
            border: 1px solid var(--ios-gray-light);
            border-radius: var(--ios-corner-large);
            font-size: 17px;
            color: var(--ios-text-primary);
            background-color: var(--ios-card);
            transition: all 0.2s ease;
            font-family: inherit;
            letter-spacing: -0.3px;
        }

        /* æ·»åŠ æ–°å¯†ç ç•Œé¢çš„å°å°ºå¯¸è¾“å…¥æ¡† */
        #addPasswordScreen input {
            padding: 8px;
            font-size: 14px;
            min-height: 32px;
        }

        input:focus {
            outline: none;
            border-color: var(--ios-primary);
            background-color: var(--ios-card);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.15);
        }

        input::placeholder {
            color: var(--ios-text-tertiary);
        }

        /* iOS æŒ‰é’®åŸºç¡€æ ·å¼ */
        .btn {
            border: none;
            padding: 16px;
            border-radius: var(--ios-corner-large);
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            font-family: inherit;
            letter-spacing: -0.3px;
            min-height: 48px;
        }

        /* æ·»åŠ æ–°å¯†ç ç•Œé¢çš„å°å°ºå¯¸æŒ‰é’® */
        #addPasswordScreen .btn {
            padding: 8px;
            font-size: 14px;
            min-height: 32px;
        }

        /* iOS ä¸»æŒ‰é’®æ ·å¼ - è“è‰² */
        .btn-primary {
            background-color: var(--ios-primary);
            color: white;
            box-shadow: var(--ios-shadow-sm);
        }
        
        /* å°å°ºå¯¸æŒ‰é’®æ ·å¼ï¼ˆå½“å‰å°ºå¯¸çš„50%ï¼‰ */
        .btn-small {
            padding: 8px !important;
            font-size: 14px !important;
            min-height: 24px !important;
        }
        
        .btn-small .btn-icon {
            font-size: 14px !important;
        }

        .btn-primary:hover {
            background-color: #0056CC;
            box-shadow: var(--ios-shadow-md);
        }

        .btn-primary:active {
            background-color: #0048A8;
            transform: scale(0.98);
        }

        /* iOS æ¬¡è¦æŒ‰é’®æ ·å¼ - ç°è‰² */
        .btn-secondary {
            background-color: var(--ios-gray-light);
            color: var(--ios-text-primary);
        }

        .btn-secondary:hover {
            background-color: #B0B0B5;
        }

        .btn-secondary:active {
            background-color: #9A9AA0;
            transform: scale(0.98);
        }

        /* iOS æˆåŠŸæŒ‰é’®æ ·å¼ - ç»¿è‰² */
        .btn-success {
            background-color: var(--ios-success);
            color: white;
            box-shadow: var(--ios-shadow-sm);
        }

        .btn-success:hover {
            background-color: #28A745;
            box-shadow: var(--ios-shadow-md);
        }

        .btn-success:active {
            background-color: #218838;
            transform: scale(0.98);
        }

        /* æŒ‰é’®å›¾æ ‡æ ·å¼ */
        .btn-icon {
            font-size: 20px;
            font-weight: 400;
        }

        /* è®¤è¯ç•Œé¢æŒ‰é’®æ ·å¼ */
        .btn-login {
            background-color: var(--ios-primary);
            color: white;
            width: 100%;
            margin-top: 16px;
            box-shadow: var(--ios-shadow-sm);
        }

        .btn-login:hover {
            background-color: #0056CC;
            box-shadow: var(--ios-shadow-md);
        }

        .btn-login:active {
            background-color: #0048A8;
            transform: scale(0.98);
        }

        .btn-forgot {
            background-color: transparent;
            color: var(--ios-primary);
            width: 100%;
            margin-top: 12px;
            font-size: 15px;
            font-weight: 500;
        }

        .btn-forgot:hover {
            background-color: rgba(0, 122, 255, 0.08);
        }

        .btn-forgot:active {
            background-color: rgba(0, 122, 255, 0.15);
            transform: scale(0.98);
        }

        /* è®¾ç½®ä¸»å¯†ç æŒ‰é’®æ ·å¼ */
        .btn-setup {
            background-color: var(--ios-primary);
            color: white;
            width: 100%;
            margin-top: 16px;
            box-shadow: var(--ios-shadow-sm);
        }

        .btn-setup:hover {
            background-color: #0056CC;
            box-shadow: var(--ios-shadow-md);
        }

        .btn-setup:active {
            background-color: #0048A8;
            transform: scale(0.98);
        }

        /* iOS é”™è¯¯æ¶ˆæ¯æ ·å¼ */
        .error-message {
            color: var(--ios-danger);
            margin-top: 8px;
            font-size: 14px;
            text-align: center;
            font-weight: 400;
            letter-spacing: -0.2px;
        }

        /* iOS è¡¨å•åŒºåŸŸæ ·å¼ */
        .form-section {
            margin-bottom: 0;
            padding: 20px;
            background: var(--ios-card);
            border-radius: var(--ios-corner-large);
            box-shadow: var(--ios-shadow-sm);
            height: 100%;
        }

        /* iOS æ ‡é¢˜æ ·å¼ */
        h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--ios-text-primary);
            font-weight: 700;
            letter-spacing: -0.4px;
        }

        /* iOS å¯†ç åˆ—è¡¨åŒºåŸŸ */
        .passwords-section {
            margin-top: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* iOS å¯†ç é¡¹æ ·å¼ */
        .password-item {
            background: var(--ios-card);
            border: 1px solid var(--ios-gray-light);
            border-radius: var(--ios-corner-large);
            padding: 20px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            box-shadow: var(--ios-shadow-sm);
        }

        .password-item:hover {
            box-shadow: var(--ios-shadow-md);
            border-color: var(--ios-gray);
        }

        /* iOS å¯†ç ä¿¡æ¯æ ·å¼ */
        .password-info h3 {
            font-size: 17px;
            margin-bottom: 4px;
            color: var(--ios-text-primary);
            font-weight: 600;
            letter-spacing: -0.3px;
        }

        .password-info p {
            font-size: 14px;
            color: var(--ios-text-secondary);
            margin-bottom: 4px;
            font-weight: 400;
            letter-spacing: -0.2px;
        }

        /* å¯†ç è¡Œæ ·å¼ */
        .password-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--ios-text-secondary);
            margin-bottom: 4px;
            font-weight: 400;
            letter-spacing: -0.2px;
        }

        /* å¯†ç æ–‡æœ¬æ ·å¼ */
        .password-text {
            font-family: monospace;
            transition: all 0.2s ease;
        }

        /* å¯†ç å¯è§æ—¶çš„æ ·å¼ */
        .password-text.visible {
            color: var(--ios-text-primary);
            font-weight: 500;
        }

        /* å¯†ç åˆ‡æ¢æŒ‰é’®æ ·å¼ */
        .password-toggle {
            padding: 6px 10px !important;
            min-height: 28px !important;
            font-size: 12px !important;
            background-color: transparent !important;
            border: 1px solid var(--ios-gray-light) !important;
            color: var(--ios-gray) !important;
            box-shadow: none !important;
        }

        .password-toggle:hover {
            background-color: rgba(0, 0, 0, 0.05) !important;
            border-color: var(--ios-gray) !important;
            color: var(--ios-gray-dark) !important;
        }

        /* å¯†ç å¯è§æ—¶çš„æŒ‰é’®æ ·å¼ */
        .password-toggle.visible {
            color: var(--ios-primary) !important;
            border-color: var(--ios-primary) !important;
        }

        .password-toggle.visible:hover {
            background-color: rgba(0, 122, 255, 0.05) !important;
        }

        /* äºŒæ¬¡å®‰å…¨éªŒè¯å¾½ç« æ ·å¼ */
        .secondary-auth-badge {
            font-size: 14px;
            color: var(--ios-primary);
            font-weight: bold;
        }

        /* äºŒæ¬¡å®‰å…¨éªŒè¯å¼¹çª—æ ·å¼ */
        .secondary-auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000000;
            animation: fade-in 0.3s ease;
        }

        .secondary-auth-modal-content {
            background-color: var(--ios-card);
            border-radius: var(--ios-corner-xl);
            padding: 24px;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--ios-shadow-lg);
            animation: slide-up 0.3s ease;
        }

        .secondary-auth-modal h3 {
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: 600;
            color: var(--ios-text-primary);
        }

        .secondary-auth-modal .form-group {
            margin-bottom: 20px;
        }

        .secondary-auth-modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        /* iOS å¯†ç æ“ä½œæŒ‰é’®å®¹å™¨ */
        .password-actions {
            display: flex;
            gap: 12px;
        }

        /* iOS å°æŒ‰é’®æ ·å¼ */
        .btn-sm {
            padding: 10px 16px;
            font-size: 14px;
            min-height: 36px;
            border-radius: var(--ios-corner-medium);
        }

        /* iOS åˆ é™¤æŒ‰é’®æ ·å¼ - çº¢è‰² */
        .btn-delete {
            background-color: var(--ios-danger);
            color: white;
            border: none;
            box-shadow: var(--ios-shadow-sm);
        }

        .btn-delete:hover {
            background-color: #CC2E23;
            box-shadow: var(--ios-shadow-md);
        }

        .btn-delete:active {
            background-color: #A8261E;
            transform: scale(0.98);
        }

        /* iOS å¤åˆ¶æŒ‰é’®æ ·å¼ - ç»¿è‰² */
        .btn-copy {
            background-color: var(--ios-success);
            color: white;
            border: none;
            box-shadow: var(--ios-shadow-sm);
        }

        .btn-copy:hover {
            background-color: #28A745;
            box-shadow: var(--ios-shadow-md);
        }

        .btn-copy:active {
            background-color: #218838;
            transform: scale(0.98);
        }

        /* iOS ç©ºçŠ¶æ€æ ·å¼ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--ios-text-secondary);
            background: var(--ios-card);
            border-radius: var(--ios-corner-large);
            box-shadow: var(--ios-shadow-sm);
        }

        .empty-state::before {
            content: "ğŸ“­";
            font-size: 60px;
            display: block;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* ç•Œé¢å®¹å™¨ */
        #authScreen {
            display: none;
        }

        #setupScreen {
            display: none;
        }

        #passwordManagerScreen {
            display: none;
            height: 100%;
        }

        /* Element Plus é£æ ¼é€šçŸ¥ç»„ä»¶æ ·å¼ */
        .el-message {
            min-width: 300px;
            box-sizing: border-box;
            border-radius: 4px;
            border: 1px solid #ebeef5;
            position: fixed;
            right: 20px;
            top: 20px;
            background-color: #edf2fc;
            transition: opacity .3s, transform .3s, top .4s;
            padding: 15px 15px 15px 20px;
            display: flex;
            align-items: center;
            z-index: 999999;
            overflow: hidden;
            opacity: 1;
            transform: translateY(0);
        }

        .el-message__icon {
            margin-right: 10px;
            font-size: 18px;
        }

        .el-message__content {
            line-height: 1;
            font-size: 14px;
            color: #303133;
        }

        .el-message__closeBtn {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 16px;
            color: #c0c4cc;
            transition: color .3s;
        }

        .el-message__closeBtn:hover {
            color: #909399;
        }

        /* é€šçŸ¥ç±»å‹æ ·å¼ */
        .el-message.success {
            background-color: #f0f9eb;
            border-color: #e1f3d8;
        }

        .el-message.success .el-message__icon {
            color: #67c23a;
        }

        .el-message.warning {
            background-color: #fdf6ec;
            border-color: #faecd8;
        }

        .el-message.warning .el-message__icon {
            color: #e6a23c;
        }

        .el-message.error {
            background-color: #fef0f0;
            border-color: #fbc4c4;
        }

        .el-message.error .el-message__icon {
            color: #f56c6c;
        }

        .el-message.info {
            background-color: #edf2fc;
            border-color: #ebeef5;
        }

        .el-message.info .el-message__icon {
            color: #909399;
        }

        /* é€šçŸ¥åŠ¨ç”» */
        @keyframes message-fade-in {
            0% {
                opacity: 0;
                transform: translateX(100%);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes message-fade-out {
            0% {
                opacity: 1;
                transform: translateX(0);
            }
            100% {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        .el-message-fade-enter {
            animation: message-fade-in 0.3s forwards;
        }

        .el-message-fade-leave {
            animation: message-fade-out 0.3s forwards;
        }
    </style>
</head>
<body>
    <!-- è®¤è¯ç•Œé¢ï¼ˆç™»å½•/è®¾ç½®ï¼‰ -->
    <div id="authScreen" class="auth-container">
        <h1 class="auth-title">PassBox</h1>
        <p class="auth-subtitle">æœ¬åœ°å¯†ç ç®¡ç†å™¨</p>
        
        <!-- ç™»å½•è¡¨å• -->
        <div id="loginForm">
            <h2 class="auth-title">ç™»å½•</h2>
            <div class="form-group">
                <label for="loginPassword">ä¸»å¯†ç </label>
                <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥ä¸»å¯†ç " required>
            </div>
            <div class="error-message" id="loginError"></div>
            <button class="btn btn-login" onclick="handleLogin()">ç™»å½•</button>
            <button class="btn btn-forgot" onclick="handleForgotPassword()">å¿˜è®°ä¸»å¯†ç </button>
        </div>
    </div>

    <!-- ä¸»å¯†ç è®¾ç½®ç•Œé¢ -->
    <div id="setupScreen" class="auth-container">
        <h1 class="auth-title">PassBox</h1>
        <p class="auth-subtitle">æœ¬åœ°å¯†ç ç®¡ç†å™¨</p>
        <h2 class="auth-title">è®¾ç½®ä¸»å¯†ç </h2>
        <p class="auth-subtitle">è¯·è®¾ç½®ä¸€ä¸ªå¼ºä¸»å¯†ç æ¥ä¿æŠ¤æ‚¨çš„å¯†ç åº“</p>
        
        <div class="form-group">
            <label for="setupPassword">ä¸»å¯†ç </label>
            <input type="password" id="setupPassword" placeholder="è¯·è¾“å…¥ä¸»å¯†ç " required>
        </div>
        <div class="form-group">
            <label for="confirmPassword">ç¡®è®¤ä¸»å¯†ç </label>
            <input type="password" id="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥ä¸»å¯†ç " required>
        </div>
        <div class="error-message" id="setupError"></div>
        <button class="btn btn-setup" onclick="handleSetup()">è®¾ç½®ä¸»å¯†ç </button>
    </div>

    <!-- å¯†ç ç®¡ç†å™¨ä¸»ç•Œé¢ -->
    <div id="passwordManagerScreen" class="container">
        <header>
            <h1>PassBox - æœ¬åœ°å¯†ç ç®¡ç†å™¨</h1>
            <!-- iOS å¯¼èˆªæ æŒ‰é’®å®¹å™¨ -->
            <div style="margin-top: 16px; display: flex; gap: 12px; justify-content: center; padding: 0 20px;">
                <button class="btn btn-success btn-small" onclick="showAddPasswordScreen()">
                     æ·»åŠ æ–°å¯†ç 
                </button>
                <button class="btn btn-primary btn-small" onclick="showSavedPasswordsScreen()">
                     æŸ¥çœ‹å·²ä¿å­˜å¯†ç 
                </button>
            </div>
        </header>
        <div class="content">
            
            <!-- æ·»åŠ æ–°å¯†ç ç•Œé¢ -->
            <div id="addPasswordScreen" style="display: block; overflow: hidden; height: 100%; flex: 1;">
                <div class="form-section" style="height: 100%; display: flex; flex-direction: column;">
                    <h2>æ·»åŠ æ–°å¯†ç </h2>
                    <form id="passwordForm" style="flex: 1; overflow-y: auto;">
                        <div class="form-group">
                            <label for="service">æœåŠ¡åç§°</label>
                            <input type="text" id="service" name="service" required placeholder="ä¾‹å¦‚ï¼šGitHubã€å¾®ä¿¡">
                        </div>
                        <div class="form-group">
                            <label for="username">ç”¨æˆ·å/é‚®ç®±</label>
                            <input type="text" id="username" name="username" required placeholder="è¾“å…¥ç”¨æˆ·åæˆ–é‚®ç®±">
                        </div>
                        <div class="form-group">
                            <label for="password">å¯†ç </label>
                            <input type="password" id="password" name="password" required placeholder="è¾“å…¥å¯†ç ">
                        </div>
                        
                        <!-- äºŒæ¬¡å®‰å…¨éªŒè¯è®¾ç½® -->
                        <div class="form-group">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <label for="enableSecondaryAuth">å¼€å¯äºŒæ¬¡å®‰å…¨éªŒè¯</label>
                                <input type="checkbox" id="enableSecondaryAuth" name="enableSecondaryAuth" style="width: auto;">
                            </div>
                        </div>
                        
                        <div class="form-group" id="secondaryPasswordGroup" style="display: none;">
                            <label for="secondaryPassword">äºŒæ¬¡å®‰å…¨å¯†ç </label>
                            <input type="password" id="secondaryPassword" name="secondaryPassword" placeholder="è®¾ç½®äºŒæ¬¡å®‰å…¨å¯†ç ">
                        </div>
                    </form>
                    <!-- ä¿å­˜å¯†ç æŒ‰é’®ï¼Œå›ºå®šåœ¨åº•éƒ¨ -->
                    <button type="submit" form="passwordForm" class="btn btn-primary" style="width: 100%; margin-top: 16px;">ä¿å­˜å¯†ç </button>
                </div>
            </div>

            <!-- å·²ä¿å­˜å¯†ç ç•Œé¢ -->
            <div id="savedPasswordsScreen" style="display: none; overflow: hidden; height: 100%; flex: 1;">
                <div class="passwords-section" style="height: 100%;">
                    <h2>å·²ä¿å­˜çš„å¯†ç </h2>
                    <div id="passwordsList" style="overflow-y: auto; height: calc(100% - 50px);"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç•Œé¢å…ƒç´ 
        const authScreen = document.getElementById('authScreen');
        const setupScreen = document.getElementById('setupScreen');
        const passwordManagerScreen = document.getElementById('passwordManagerScreen');
        const addPasswordScreen = document.getElementById('addPasswordScreen');
        const savedPasswordsScreen = document.getElementById('savedPasswordsScreen');
        const loginError = document.getElementById('loginError');
        const setupError = document.getElementById('setupError');

        // å¯†ç ç®¡ç†å…ƒç´ 
        const form = document.getElementById('passwordForm');
        const passwordsList = document.getElementById('passwordsList');

        document.addEventListener('DOMContentLoaded', async () => {
            // æ£€æŸ¥æ˜¯å¦å·²è®¾ç½®ä¸»å¯†ç 
            const isSetup = await window.passwordManager.checkMasterPasswordSetup();
            
            if (isSetup) {
                // å·²è®¾ç½®ï¼Œæ˜¾ç¤ºç™»å½•ç•Œé¢
                authScreen.style.display = 'block';
            } else {
                // æœªè®¾ç½®ï¼Œæ˜¾ç¤ºè®¾ç½®ç•Œé¢
                setupScreen.style.display = 'block';
            }
        });

        // å¤„ç†ä¸»å¯†ç è®¾ç½®
        async function handleSetup() {
            const password = document.getElementById('setupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // éªŒè¯å¯†ç 
            if (password.length < 8) {
                setupError.textContent = 'ä¸»å¯†ç é•¿åº¦è‡³å°‘ä¸º8ä¸ªå­—ç¬¦';
                return;
            }
            
            if (password !== confirmPassword) {
                setupError.textContent = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';
                return;
            }
            
            try {
                await window.passwordManager.setupMasterPassword(password);
                // è®¾ç½®æˆåŠŸï¼Œåˆ‡æ¢åˆ°å¯†ç ç®¡ç†ç•Œé¢
                setupScreen.style.display = 'none';
                passwordManagerScreen.style.display = 'block';
                // é»˜è®¤æ˜¾ç¤ºå·²ä¿å­˜å¯†ç ç•Œé¢
                await showSavedPasswordsScreen();
            } catch (error) {
                setupError.textContent = 'è®¾ç½®å¤±è´¥ï¼š' + error.message;
            }
        }

        // å¯¼èˆªå‡½æ•°ï¼šæ˜¾ç¤ºæ·»åŠ æ–°å¯†ç ç•Œé¢
        function showAddPasswordScreen() {
            addPasswordScreen.style.display = 'block';
            savedPasswordsScreen.style.display = 'none';
        }

        // å¯¼èˆªå‡½æ•°ï¼šæ˜¾ç¤ºå·²ä¿å­˜å¯†ç ç•Œé¢
        async function showSavedPasswordsScreen() {
            addPasswordScreen.style.display = 'none';
            savedPasswordsScreen.style.display = 'block';
            // åŠ è½½æœ€æ–°çš„å¯†ç åˆ—è¡¨
            await loadPasswords();
        }

        // å¤„ç†ç™»å½•
        async function handleLogin() {
            const password = document.getElementById('loginPassword').value;
            
            // éªŒè¯è¾“å…¥
            if (!password || password.trim() === '') {
                loginError.textContent = 'è¯·è¾“å…¥ä¸»å¯†ç ';
                return;
            }
            
            try {
                    const result = await window.passwordManager.loginMasterPassword(password);
                    if (result.success) {
                        // ç™»å½•æˆåŠŸï¼Œåˆ‡æ¢åˆ°å¯†ç ç®¡ç†ç•Œé¢
                        authScreen.style.display = 'none';
                        passwordManagerScreen.style.display = 'block';
                        // é»˜è®¤æ˜¾ç¤ºå·²ä¿å­˜å¯†ç ç•Œé¢
                        await showSavedPasswordsScreen();
                    } else {
                        loginError.textContent = result.message;
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    loginError.textContent = 'ç™»å½•å¤±è´¥ï¼š' + error.message;
                }
        }

        // å¤„ç†å¿˜è®°ä¸»å¯†ç 
        async function handleForgotPassword() {
            // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
            const confirmMessage = `æ³¨æ„ï¼š
1. ç”±äºåŠ å¯†åŸç†é™åˆ¶ï¼Œå¿˜è®°ä¸»å¯†ç åæ— æ³•æ¢å¤å·²ä¿å­˜çš„å¯†ç 
2. ç‚¹å‡»ç¡®å®šåï¼Œæ‰€æœ‰æœ¬åœ°æ•°æ®å°†è¢«æ¸…é™¤
3. æ‚¨éœ€è¦é‡æ–°è®¾ç½®ä¸»å¯†ç 

ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ`;
            
            // ä½¿ç”¨åŸç”Ÿconfirmï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦é˜»å¡è¡Œä¸º
            if (confirm(confirmMessage)) {
                try {
                    const result = await window.passwordManager.forgotMasterPassword();
                    if (result.success) {
                        message.success(result.message);
                        // é‡æ–°æ˜¾ç¤ºä¸»å¯†ç è®¾ç½®ç•Œé¢
                        authScreen.style.display = 'none';
                        setupScreen.style.display = 'block';
                    } else {
                        message.error('æ“ä½œå¤±è´¥ï¼š' + result.message);
                    }
                } catch (error) {
                    console.error('Forgot password error:', error);
                    message.error('æ“ä½œå¤±è´¥ï¼š' + error.message);
                }
            }
        }

        // å¤„ç†ä¸»å¯†ç è®¾ç½®æˆåŠŸåçš„é€»è¾‘
        async function handleSetupSuccess() {
            setupScreen.style.display = 'none';
            passwordManagerScreen.style.display = 'block';
            // é»˜è®¤æ˜¾ç¤ºæ·»åŠ å¯†ç ç•Œé¢
            showAddPasswordScreen();
        }

        // åŠ è½½å·²ä¿å­˜çš„å¯†ç 
        async function loadPasswords() {
            const passwords = await window.passwordManager.getPasswords();
            renderPasswords(passwords);
        }

        // æ¸²æŸ“å¯†ç åˆ—è¡¨
        function renderPasswords(passwords) {
            if (passwords.length === 0) {
                passwordsList.innerHTML = '<div class="empty-state">æš‚æ— ä¿å­˜çš„å¯†ç </div>';
                return;
            }

            passwordsList.innerHTML = passwords.map(password => `
                <div class="password-item" data-id="${password.id}">
                    <div class="password-info">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <h3>${password.service}</h3>
                            ${password.enableSecondaryAuth ? '<span class="secondary-auth-badge" title="å·²å¼€å¯äºŒæ¬¡å®‰å…¨éªŒè¯">ğŸ”’</span>' : ''}
                        </div>
                        <p>ç”¨æˆ·å: ${password.username}</p>
                        <div class="password-row">
                            <span>å¯†ç : </span>
                            <span class="password-text" id="password-text-${password.id}">${'*'.repeat(password.password.length)}</span>
                            <button 
                                class="btn btn-secondary btn-sm password-toggle" 
                                onclick="togglePasswordVisibility('${password.id}', '${password.password}', ${password.enableSecondaryAuth})"
                                aria-label="åˆ‡æ¢å¯†ç å¯è§æ€§"
                                aria-pressed="false"
                                data-password="${password.password}"
                                data-has-secondary-auth="${password.enableSecondaryAuth}"
                            >
                                <span class="btn-icon">ğŸ‘ï¸</span>
                            </button>
                        </div>
                    </div>
                    <div class="password-actions">
                        <button class="btn btn-success btn-sm" onclick="copyPassword('${password.id}', '${password.password}', ${password.enableSecondaryAuth})">
                            <span class="btn-icon">ğŸ“‹</span> å¤åˆ¶
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="toggleSecondaryAuth('${password.id}', ${password.enableSecondaryAuth})">
                            <span class="btn-icon">${password.enableSecondaryAuth ? 'ğŸ”“' : 'ğŸ”’'}</span> ${password.enableSecondaryAuth ? 'å…³é—­' : 'å¼€å¯'}äºŒæ¬¡éªŒè¯
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deletePassword('${password.id}')">
                            <span class="btn-icon">ğŸ—‘ï¸</span> åˆ é™¤
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // å¤åˆ¶å¯†ç åˆ°å‰ªè´´æ¿
        window.copyPassword = async (id, password, hasSecondaryAuth) => {
            if (hasSecondaryAuth) {
                // å·²å¼€å¯äºŒæ¬¡å®‰å…¨éªŒè¯ï¼Œæ˜¾ç¤ºéªŒè¯å¼¹çª—
                const modal = document.createElement('div');
                modal.className = 'secondary-auth-modal';
                modal.innerHTML = `
                    <div class="secondary-auth-modal-content">
                        <h3>å¤åˆ¶å¯†ç </h3>
                        <div class="form-group">
                            <label for="verify-copy-secondary-password-${id}">è¯·è¾“å…¥äºŒæ¬¡å®‰å…¨å¯†ç è¿›è¡ŒéªŒè¯</label>
                            <input type="password" id="verify-copy-secondary-password-${id}" placeholder="è¾“å…¥äºŒæ¬¡å®‰å…¨å¯†ç " required>
                        </div>
                        <div class="error-message" id="verify-copy-secondary-error-${id}" style="margin-top: -16px; margin-bottom: 16px;"></div>
                        <div class="secondary-auth-modal-buttons">
                            <button class="btn btn-secondary" onclick="closeSecondaryAuthModal('${id}')">å–æ¶ˆ</button>
                            <button class="btn btn-primary" onclick="verifyAndCopyPassword('${id}', '${password}')">ç¡®å®š</button>
                        </div>
                    </div>
                `;
                
                // æ·»åŠ åˆ°æ–‡æ¡£
                document.body.appendChild(modal);
            } else {
                // æœªå¼€å¯äºŒæ¬¡å®‰å…¨éªŒè¯ï¼Œç›´æ¥å¤åˆ¶
                await navigator.clipboard.writeText(password);
                message.success('å¯†ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }
        };
        
        // éªŒè¯å¹¶å¤åˆ¶å¯†ç 
        window.verifyAndCopyPassword = async (id, password) => {
            const passwordInput = document.getElementById(`verify-copy-secondary-password-${id}`);
            const errorEl = document.getElementById(`verify-copy-secondary-error-${id}`);
            const secondaryPassword = passwordInput.value;
            
            if (!secondaryPassword) {
                errorEl.textContent = 'è¯·è¾“å…¥äºŒæ¬¡å®‰å…¨å¯†ç ';
                return;
            }
            
            try {
                // å…ˆéªŒè¯äºŒæ¬¡å®‰å…¨å¯†ç 
                const verifyResult = await window.passwordManager.verifySecondaryPassword({
                    id: id,
                    secondaryPassword: secondaryPassword
                });
                
                if (verifyResult.success) {
                    // éªŒè¯æˆåŠŸï¼Œæ‰§è¡Œå¤åˆ¶æ“ä½œ
                    await navigator.clipboard.writeText(password);
                    
                    // å…³é—­å¼¹çª—
                    closeSecondaryAuthModal(id);
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    message.success('å¯†ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                } else {
                    // éªŒè¯å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    errorEl.textContent = 'äºŒæ¬¡å®‰å…¨éªŒè¯å¯†ç è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°å°è¯•';
                }
            } catch (error) {
                console.error('å¤åˆ¶å¯†ç å¤±è´¥:', error);
                errorEl.textContent = 'å¤åˆ¶å¯†ç å¤±è´¥ï¼Œè¯·é‡è¯•';
            }
        };

        // iOS é£æ ¼åˆ é™¤å¯†ç ç¡®è®¤
        window.deletePassword = async (id) => {
            // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
            if (window.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯†ç å—ï¼Ÿ')) {
                try {
                    // è·å–å½“å‰å¯†ç åˆ—è¡¨ï¼Œæ£€æŸ¥è¦åˆ é™¤çš„å¯†ç é¡¹æ˜¯å¦å¼€å¯äº†äºŒæ¬¡å®‰å…¨éªŒè¯
                    const passwords = await window.passwordManager.getPasswords();
                    const passwordItem = passwords.find(item => item.id === id);
                    
                    if (passwordItem && passwordItem.enableSecondaryAuth) {
                        // å·²å¼€å¯äºŒæ¬¡å®‰å…¨éªŒè¯ï¼Œæ˜¾ç¤ºéªŒè¯å¼¹çª—
                        const modal = document.createElement('div');
                        modal.className = 'secondary-auth-modal';
                        modal.innerHTML = `
                            <div class="secondary-auth-modal-content">
                                <h3>åˆ é™¤å¯†ç </h3>
                                <div class="form-group">
                                    <label for="verify-delete-secondary-password-${id}">è¯·è¾“å…¥äºŒæ¬¡å®‰å…¨å¯†ç è¿›è¡ŒéªŒè¯</label>
                                    <input type="password" id="verify-delete-secondary-password-${id}" placeholder="è¾“å…¥äºŒæ¬¡å®‰å…¨å¯†ç " required>
                                </div>
                                <div class="error-message" id="verify-delete-secondary-error-${id}" style="margin-top: -16px; margin-bottom: 16px;"></div>
                                <div class="secondary-auth-modal-buttons">
                                    <button class="btn btn-secondary" onclick="closeSecondaryAuthModal('${id}')">å–æ¶ˆ</button>
                                    <button class="btn btn-primary" onclick="verifyAndDeletePassword('${id}')">ç¡®å®š</button>
                                </div>
                            </div>
                        `;
                        
                        // æ·»åŠ åˆ°æ–‡æ¡£
                        document.body.appendChild(modal);
                    } else {
                        // æœªå¼€å¯äºŒæ¬¡å®‰å…¨éªŒè¯ï¼Œç›´æ¥åˆ é™¤
                        await window.passwordManager.deletePassword(id);
                        loadPasswords();
                        message.success('å¯†ç å·²åˆ é™¤');
                    }
                } catch (error) {
                    console.error('åˆ é™¤å¯†ç å¤±è´¥:', error);
                    message.error('åˆ é™¤å¯†ç å¤±è´¥');
                }
            }
        };
        
        // éªŒè¯å¹¶åˆ é™¤å¯†ç 
        window.verifyAndDeletePassword = async (id) => {
            const passwordInput = document.getElementById(`verify-delete-secondary-password-${id}`);
            const errorEl = document.getElementById(`verify-delete-secondary-error-${id}`);
            const secondaryPassword = passwordInput.value;
            
            if (!secondaryPassword) {
                errorEl.textContent = 'è¯·è¾“å…¥äºŒæ¬¡å®‰å…¨å¯†ç ';
                return;
            }
            
            try {
                // å…ˆéªŒè¯äºŒæ¬¡å®‰å…¨å¯†ç 
                const verifyResult = await window.passwordManager.verifySecondaryPassword({
                    id: id,
                    secondaryPassword: secondaryPassword
                });
                
                if (verifyResult.success) {
                    // éªŒè¯æˆåŠŸï¼Œæ‰§è¡Œåˆ é™¤æ“ä½œ
                    await window.passwordManager.deletePassword(id);
                    
                    // å…³é—­å¼¹çª—
                    closeSecondaryAuthModal(id);
                    
                    // æ›´æ–°å¯†ç åˆ—è¡¨
                    loadPasswords();
                    message.success('å¯†ç å·²åˆ é™¤');
                } else {
                    // éªŒè¯å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    errorEl.textContent = 'äºŒæ¬¡å®‰å…¨éªŒè¯å¯†ç è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°å°è¯•';
                }
            } catch (error) {
                console.error('åˆ é™¤å¯†ç å¤±è´¥:', error);
                errorEl.textContent = 'åˆ é™¤å¯†ç å¤±è´¥ï¼Œè¯·é‡è¯•';
            }
        };

        // äºŒæ¬¡å®‰å…¨éªŒè¯å¼€å…³çš„æ˜¾ç¤º/éšè—é€»è¾‘
        const enableSecondaryAuthCheckbox = document.getElementById('enableSecondaryAuth');
        const secondaryPasswordGroup = document.getElementById('secondaryPasswordGroup');
        
        if (enableSecondaryAuthCheckbox && secondaryPasswordGroup) {
            enableSecondaryAuthCheckbox.addEventListener('change', () => {
                secondaryPasswordGroup.style.display = enableSecondaryAuthCheckbox.checked ? 'block' : 'none';
            });
        }

        // ä¿å­˜æ–°å¯†ç 
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(form);
            const enableSecondaryAuth = formData.get('enableSecondaryAuth') === 'on';
            const secondaryPassword = formData.get('secondaryPassword');
            
            // éªŒè¯äºŒæ¬¡å®‰å…¨å¯†ç 
            if (enableSecondaryAuth && !secondaryPassword) {
                message.error('è¯·è®¾ç½®äºŒæ¬¡å®‰å…¨å¯†ç ');
                return;
            }
            
            const passwordData = {
                service: formData.get('service'),
                username: formData.get('username'),
                password: formData.get('password'),
                enableSecondaryAuth: enableSecondaryAuth,
                secondaryPassword: secondaryPassword
            };

            await window.passwordManager.savePassword(passwordData);
            form.reset();
            
            // é‡ç½®äºŒæ¬¡å®‰å…¨éªŒè¯å¼€å…³çŠ¶æ€
            if (enableSecondaryAuthCheckbox) {
                enableSecondaryAuthCheckbox.checked = false;
            }
            if (secondaryPasswordGroup) {
                secondaryPasswordGroup.style.display = 'none';
            }
            
            // Element Plus é£æ ¼ä¿å­˜æˆåŠŸæç¤º
            message.success('å¯†ç å·²æˆåŠŸä¿å­˜ï¼');
            
            // è‡ªåŠ¨åˆ‡æ¢åˆ°å·²ä¿å­˜å¯†ç ç•Œé¢
            await showSavedPasswordsScreen();
        });

        // äºŒæ¬¡å®‰å…¨éªŒè¯å¼¹çª—
        function showSecondaryAuthModal(passwordId, password, callback) {
            // åˆ›å»ºå¼¹çª—å…ƒç´ 
            const modal = document.createElement('div');
            modal.className = 'secondary-auth-modal';
            modal.innerHTML = `
                <div class="secondary-auth-modal-content">
                    <h3>äºŒæ¬¡å®‰å…¨éªŒè¯</h3>
                    <div class="form-group">
                        <label for="secondary-auth-password-${passwordId}">è¯·è¾“å…¥äºŒæ¬¡å®‰å…¨å¯†ç </label>
                        <input type="password" id="secondary-auth-password-${passwordId}" placeholder="è¾“å…¥äºŒæ¬¡å®‰å…¨å¯†ç " required>
                    </div>
                    <div class="error-message" id="secondary-auth-error-${passwordId}" style="margin-top: -16px; margin-bottom: 16px;"></div>
                    <div class="secondary-auth-modal-buttons">
                        <button class="btn btn-secondary" onclick="closeSecondaryAuthModal('${passwordId}')">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="verifySecondaryPassword('${passwordId}', '${password}', ${callback ? 'true' : 'false'})">ç¡®å®š</button>
                    </div>
                </div>
            `;
            
            // æ·»åŠ åˆ°æ–‡æ¡£
            document.body.appendChild(modal);
            
            // ä¿å­˜å›è°ƒå‡½æ•°
            modal.callback = callback;
        }
        
        // å…³é—­äºŒæ¬¡å®‰å…¨éªŒè¯å¼¹çª—
        window.closeSecondaryAuthModal = (passwordId) => {
            const modal = document.querySelector('.secondary-auth-modal');
            if (modal) {
                document.body.removeChild(modal);
            }
        };
        
        // éªŒè¯äºŒæ¬¡å®‰å…¨å¯†ç 
        window.verifySecondaryPassword = async (passwordId, password, hasCallback) => {
            const passwordInput = document.getElementById(`secondary-auth-password-${passwordId}`);
            const errorEl = document.getElementById(`secondary-auth-error-${passwordId}`);
            const secondaryPassword = passwordInput.value;
            
            if (!secondaryPassword) {
                errorEl.textContent = 'è¯·è¾“å…¥äºŒæ¬¡å®‰å…¨å¯†ç ';
                return;
            }
            
            try {
                const result = await window.passwordManager.verifySecondaryPassword({
                    id: passwordId,
                    secondaryPassword: secondaryPassword
                });
                
                if (result.success) {
                    // éªŒè¯æˆåŠŸï¼Œå…³é—­å¼¹çª—
                    closeSecondaryAuthModal(passwordId);
                    
                    // è°ƒç”¨å›è°ƒå‡½æ•°æ˜¾ç¤ºå¯†ç 
                    if (hasCallback) {
                        // ç›´æ¥æ˜¾ç¤ºå¯†ç 
                        const passwordTextEl = document.getElementById(`password-text-${passwordId}`);
                        const toggleBtnEl = passwordTextEl.nextElementSibling;
                        
                        passwordTextEl.textContent = password;
                        passwordTextEl.classList.add('visible');
                        toggleBtnEl.classList.add('visible');
                        toggleBtnEl.setAttribute('aria-pressed', 'true');
                        toggleBtnEl.querySelector('.btn-icon').textContent = 'ğŸ™ˆ';
                        toggleBtnEl.setAttribute('aria-label', 'éšè—å¯†ç ');
                        
                        // æ·»åŠ è‡ªåŠ¨éšè—æœºåˆ¶ï¼ˆ5ç§’åè‡ªåŠ¨éšè—ï¼‰
                        setTimeout(() => {
                            if (passwordTextEl.classList.contains('visible')) {
                                passwordTextEl.textContent = '*'.repeat(password.length);
                                passwordTextEl.classList.remove('visible');
                                toggleBtnEl.classList.remove('visible');
                                toggleBtnEl.setAttribute('aria-pressed', 'false');
                                toggleBtnEl.querySelector('.btn-icon').textContent = 'ğŸ‘ï¸';
                                toggleBtnEl.setAttribute('aria-label', 'æ˜¾ç¤ºå¯†ç ');
                            }
                        }, 5000);
                    }
                } else {
                    // éªŒè¯å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    errorEl.textContent = result.message;
                }
            } catch (error) {
                console.error('éªŒè¯äºŒæ¬¡å®‰å…¨å¯†ç å¤±è´¥:', error);
                errorEl.textContent = 'éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•';
            }
        };
        
        // å¯†ç å¯è§æ€§åˆ‡æ¢åŠŸèƒ½
        window.togglePasswordVisibility = (id, password, hasSecondaryAuth) => {
            const passwordTextEl = document.getElementById(`password-text-${id}`);
            const toggleBtnEl = passwordTextEl.nextElementSibling;
            const isVisible = passwordTextEl.classList.contains('visible');
            
            if (isVisible) {
                // åˆ‡æ¢ä¸ºéšè—çŠ¶æ€
                passwordTextEl.textContent = '*'.repeat(password.length);
                passwordTextEl.classList.remove('visible');
                toggleBtnEl.classList.remove('visible');
                toggleBtnEl.setAttribute('aria-pressed', 'false');
                toggleBtnEl.querySelector('.btn-icon').textContent = 'ğŸ‘ï¸';
                toggleBtnEl.setAttribute('aria-label', 'æ˜¾ç¤ºå¯†ç ');
            } else {
                // æ£€æŸ¥æ˜¯å¦éœ€è¦äºŒæ¬¡å®‰å…¨éªŒè¯
                if (hasSecondaryAuth) {
                    // æ˜¾ç¤ºäºŒæ¬¡å®‰å…¨éªŒè¯å¼¹çª—
                    showSecondaryAuthModal(id, password, true);
                } else {
                    // ç›´æ¥åˆ‡æ¢ä¸ºå¯è§çŠ¶æ€
                    passwordTextEl.textContent = password;
                    passwordTextEl.classList.add('visible');
                    toggleBtnEl.classList.add('visible');
                    toggleBtnEl.setAttribute('aria-pressed', 'true');
                    toggleBtnEl.querySelector('.btn-icon').textContent = 'ğŸ™ˆ';
                    toggleBtnEl.setAttribute('aria-label', 'éšè—å¯†ç ');
                    
                    // æ·»åŠ è‡ªåŠ¨éšè—æœºåˆ¶ï¼ˆ5ç§’åè‡ªåŠ¨éšè—ï¼‰
                    setTimeout(() => {
                        if (passwordTextEl.classList.contains('visible')) {
                            passwordTextEl.textContent = '*'.repeat(password.length);
                            passwordTextEl.classList.remove('visible');
                            toggleBtnEl.classList.remove('visible');
                            toggleBtnEl.setAttribute('aria-pressed', 'false');
                            toggleBtnEl.querySelector('.btn-icon').textContent = 'ğŸ‘ï¸';
                            toggleBtnEl.setAttribute('aria-label', 'æ˜¾ç¤ºå¯†ç ');
                        }
                    }, 5000);
                }
            }
        };
        
        // å¼€å¯/å…³é—­äºŒæ¬¡å®‰å…¨éªŒè¯
        window.toggleSecondaryAuth = (id, currentStatus) => {
            if (currentStatus) {
                // å·²å¼€å¯ï¼Œå…³é—­äºŒæ¬¡éªŒè¯
                disableSecondaryAuth(id);
            } else {
                // æœªå¼€å¯ï¼Œå¼€å¯äºŒæ¬¡éªŒè¯
                enableSecondaryAuth(id);
            }
        };
        
        // å¼€å¯äºŒæ¬¡å®‰å…¨éªŒè¯
        function enableSecondaryAuth(id) {
            // åˆ›å»ºè®¾ç½®äºŒæ¬¡å®‰å…¨å¯†ç çš„å¼¹çª—
            const modal = document.createElement('div');
            modal.className = 'secondary-auth-modal';
            modal.innerHTML = `
                <div class="secondary-auth-modal-content">
                    <h3>å¼€å¯äºŒæ¬¡å®‰å…¨éªŒè¯</h3>
                    <div class="form-group">
                        <label for="set-secondary-password-${id}">è®¾ç½®äºŒæ¬¡å®‰å…¨å¯†ç </label>
                        <input type="password" id="set-secondary-password-${id}" placeholder="è®¾ç½®äºŒæ¬¡å®‰å…¨å¯†ç " required>
                    </div>
                    <div class="form-group">
                        <label for="confirm-secondary-password-${id}">ç¡®è®¤äºŒæ¬¡å®‰å…¨å¯†ç </label>
                        <input type="password" id="confirm-secondary-password-${id}" placeholder="ç¡®è®¤äºŒæ¬¡å®‰å…¨å¯†ç " required>
                    </div>
                    <div class="error-message" id="set-secondary-auth-error-${id}" style="margin-top: -16px; margin-bottom: 16px;"></div>
                    <div class="secondary-auth-modal-buttons">
                        <button class="btn btn-secondary" onclick="closeSecondaryAuthModal('${id}')">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="saveSecondaryAuthSettings('${id}', true)">ç¡®å®š</button>
                    </div>
                </div>
            `;
            
            // æ·»åŠ åˆ°æ–‡æ¡£
            document.body.appendChild(modal);
        }
        
        // å…³é—­äºŒæ¬¡å®‰å…¨éªŒè¯
        function disableSecondaryAuth(id) {
            // æ˜¾ç¤ºç¡®è®¤å¼¹çª—
            if (window.confirm('ç¡®å®šè¦å…³é—­äºŒæ¬¡å®‰å…¨éªŒè¯å—ï¼Ÿ')) {
                // æ˜¾ç¤ºäºŒæ¬¡å®‰å…¨å¯†ç éªŒè¯å¼¹çª—
                const modal = document.createElement('div');
                modal.className = 'secondary-auth-modal';
                modal.innerHTML = `
                    <div class="secondary-auth-modal-content">
                        <h3>å…³é—­äºŒæ¬¡å®‰å…¨éªŒè¯</h3>
                        <div class="form-group">
                            <label for="verify-disable-secondary-password-${id}">è¯·è¾“å…¥äºŒæ¬¡å®‰å…¨å¯†ç è¿›è¡ŒéªŒè¯</label>
                            <input type="password" id="verify-disable-secondary-password-${id}" placeholder="è¾“å…¥äºŒæ¬¡å®‰å…¨å¯†ç " required>
                        </div>
                        <div class="error-message" id="verify-disable-secondary-error-${id}" style="margin-top: -16px; margin-bottom: 16px;"></div>
                        <div class="secondary-auth-modal-buttons">
                            <button class="btn btn-secondary" onclick="closeSecondaryAuthModal('${id}')">å–æ¶ˆ</button>
                            <button class="btn btn-primary" onclick="verifyAndDisableSecondaryAuth('${id}')">ç¡®å®š</button>
                        </div>
                    </div>
                `;
                
                // æ·»åŠ åˆ°æ–‡æ¡£
                document.body.appendChild(modal);
            }
        }
        
        // éªŒè¯å¹¶å…³é—­äºŒæ¬¡å®‰å…¨éªŒè¯
        window.verifyAndDisableSecondaryAuth = async (id) => {
            const passwordInput = document.getElementById(`verify-disable-secondary-password-${id}`);
            const errorEl = document.getElementById(`verify-disable-secondary-error-${id}`);
            const secondaryPassword = passwordInput.value;
            
            if (!secondaryPassword) {
                errorEl.textContent = 'è¯·è¾“å…¥äºŒæ¬¡å®‰å…¨å¯†ç ';
                return;
            }
            
            try {
                // å…ˆéªŒè¯äºŒæ¬¡å®‰å…¨å¯†ç 
                const verifyResult = await window.passwordManager.verifySecondaryPassword({
                    id: id,
                    secondaryPassword: secondaryPassword
                });
                
                if (verifyResult.success) {
                    // éªŒè¯æˆåŠŸï¼Œå…³é—­äºŒæ¬¡éªŒè¯
                    await window.passwordManager.updateSecondaryAuth({
                        id: id,
                        enableSecondaryAuth: false,
                        secondaryPassword: ''
                    });
                    
                    // å…³é—­å¼¹çª—
                    closeSecondaryAuthModal(id);
                    
                    // æ›´æ–°å¯†ç åˆ—è¡¨
                    showSavedPasswordsScreen();
                    message.success('äºŒæ¬¡å®‰å…¨éªŒè¯å·²å…³é—­');
                } else {
                    // éªŒè¯å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    errorEl.textContent = 'äºŒæ¬¡å®‰å…¨å¯†ç ä¸æ­£ç¡®';
                }
            } catch (error) {
                console.error('å…³é—­äºŒæ¬¡å®‰å…¨éªŒè¯å¤±è´¥:', error);
                errorEl.textContent = 'éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•';
            }
        };
        
        // ä¿å­˜äºŒæ¬¡å®‰å…¨éªŒè¯è®¾ç½®
        window.saveSecondaryAuthSettings = async (id, enable) => {
            const passwordInput = document.getElementById(`set-secondary-password-${id}`);
            const confirmInput = document.getElementById(`confirm-secondary-password-${id}`);
            const errorEl = document.getElementById(`set-secondary-auth-error-${id}`);
            
            const password = passwordInput.value;
            const confirmPassword = confirmInput.value;
            
            if (!password) {
                errorEl.textContent = 'è¯·è®¾ç½®äºŒæ¬¡å®‰å…¨å¯†ç ';
                return;
            }
            
            if (password !== confirmPassword) {
                errorEl.textContent = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';
                return;
            }
            
            try {
                await window.passwordManager.updateSecondaryAuth({
                    id: id,
                    enableSecondaryAuth: enable,
                    secondaryPassword: password
                });
                
                // å…³é—­å¼¹çª—
                closeSecondaryAuthModal(id);
                
                // æ›´æ–°å¯†ç åˆ—è¡¨
                showSavedPasswordsScreen();
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                message.success('äºŒæ¬¡å®‰å…¨éªŒè¯å·²' + (enable ? 'å¼€å¯' : 'å…³é—­'));
            } catch (error) {
                console.error('æ›´æ–°äºŒæ¬¡å®‰å…¨éªŒè¯è®¾ç½®å¤±è´¥:', error);
                errorEl.textContent = 'æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•';
            }
        };
    </script>
    
    <!-- Element Plus é£æ ¼é€šçŸ¥ç»„ä»¶ JavaScript -->
    <script>
        // Element Plus é£æ ¼é€šçŸ¥ç»„ä»¶ JavaScript
        class Message {
            constructor() {
                this.instances = [];
                this.verticalOffset = 20;
                this.zIndex = 999999;
            }

            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            createInstance(options) {
                const defaultOptions = {
                    type: 'info',
                    message: '',
                    duration: 3000,
                    showClose: true,
                    onClose: null
                };

                const finalOptions = { ...defaultOptions, ...options };
                const instance = document.createElement('div');
                instance.className = `el-message el-message--${finalOptions.type} el-message-fade-enter`;
                instance.style.zIndex = this.zIndex++;
                instance.style.top = `${this.verticalOffset}px`;

                // æ›´æ–°å‚ç›´åç§»é‡
                this.verticalOffset += 60;

                // åˆ›å»ºå†…å®¹
                let icon = '';
                switch (finalOptions.type) {
                    case 'success':
                        icon = 'âœ…';
                        break;
                    case 'warning':
                        icon = 'âš ï¸';
                        break;
                    case 'error':
                        icon = 'âŒ';
                        break;
                    case 'info':
                        icon = 'â„¹ï¸';
                        break;
                }

                let closeBtn = '';
                if (finalOptions.showClose) {
                    closeBtn = '<i class="el-message__closeBtn">Ã—</i>';
                }

                instance.innerHTML = `
                    <div class="el-message__icon">${icon}</div>
                    <div class="el-message__content">${finalOptions.message}</div>
                    ${closeBtn}
                `;

                // æ·»åŠ åˆ°DOM
                document.body.appendChild(instance);

                // è‡ªåŠ¨å…³é—­
                let timer = null;
                if (finalOptions.duration > 0) {
                    timer = setTimeout(() => {
                        this.close(instance, finalOptions.onClose);
                    }, finalOptions.duration);
                }

                // æ‰‹åŠ¨å…³é—­
                const closeBtnEl = instance.querySelector('.el-message__closeBtn');
                if (closeBtnEl) {
                    closeBtnEl.addEventListener('click', () => {
                        this.close(instance, finalOptions.onClose);
                    });
                }

                // å­˜å‚¨å®ä¾‹
                const instanceObj = {
                    el: instance,
                    timer
                };
                this.instances.push(instanceObj);

                return instanceObj;
            }

            // å…³é—­é€šçŸ¥
            close(instance, onClose) {
                // æŸ¥æ‰¾å®ä¾‹ç´¢å¼•
                const index = this.instances.findIndex(item => item.el === instance);
                if (index === -1) return;

                // æ¸…é™¤å®šæ—¶å™¨
                clearTimeout(this.instances[index].timer);

                // ç§»é™¤å®ä¾‹
                this.instances.splice(index, 1);

                // æ›´æ–°åç»­é€šçŸ¥çš„ä½ç½®
                this.updateVerticalOffset();

                // æ·»åŠ ç¦»å¼€åŠ¨ç”»
                instance.classList.remove('el-message-fade-enter');
                instance.classList.add('el-message-fade-leave');

                // ç§»é™¤DOM
                setTimeout(() => {
                    if (instance.parentNode) {
                        instance.parentNode.removeChild(instance);
                    }
                    if (onClose) onClose();
                }, 300);
            }

            // æ›´æ–°å‚ç›´åç§»é‡
            updateVerticalOffset() {
                this.verticalOffset = 20;
                this.instances.forEach((instance, index) => {
                    instance.el.style.top = `${this.verticalOffset}px`;
                    this.verticalOffset += 60;
                });
            }

            // å„ç§ç±»å‹çš„é€šçŸ¥æ–¹æ³•
            success(message, options = {}) {
                return this.createInstance({ ...options, type: 'success', message });
            }

            warning(message, options = {}) {
                return this.createInstance({ ...options, type: 'warning', message });
            }

            error(message, options = {}) {
                return this.createInstance({ ...options, type: 'error', message });
            }

            info(message, options = {}) {
                return this.createInstance({ ...options, type: 'info', message });
            }
        }

        // åˆ›å»ºå…¨å±€å®ä¾‹
        const message = new Message();
        
        // æ›¿æ¢å…¨å±€alertå‡½æ•°
        const originalAlert = window.alert;
        window.alert = function(msg) {
            message.info(msg);
        };
        
        // æ›¿æ¢å…¨å±€confirmå‡½æ•°ï¼ˆç®€åŒ–ç‰ˆï¼Œä»…æ”¯æŒç¡®å®šæ“ä½œï¼‰
        const originalConfirm = window.confirm;
        window.confirm = function(msg) {
            // åˆ›å»ºä¸€ä¸ªPromiseæ¥æ¨¡æ‹Ÿconfirmçš„å¼‚æ­¥è¡Œä¸º
            return new Promise((resolve) => {
                // åˆ›å»ºä¸€ä¸ªç¡®è®¤å¯¹è¯æ¡†ï¼ˆç®€åŒ–ç‰ˆï¼Œç›´æ¥è°ƒç”¨æˆåŠŸå›è°ƒï¼‰
                // æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬æ— æ³•çœŸæ­£æ›¿æ¢confirmçš„é˜»å¡è¡Œä¸ºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹è°ƒç”¨confirmçš„ä»£ç 
                // è¿™é‡Œåªæ˜¯ä¸€ä¸ªä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼Œåé¢ä¼šä¿®æ”¹æ‰€æœ‰çš„confirmè°ƒç”¨
                resolve(true);
            });
        };
    </script>
</body>
</html>